<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quote Slip Detail - Unlockt</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #5fa88a 0%, #4a8b6e 100%);
      color: white;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
      display: inline-block;
      transition: all 0.2s;
    }

    .btn-back {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn-back:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .submission-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin-bottom: 20px;
    }

    .submission-header {
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 20px;
      margin-bottom: 30px;
    }

    .submission-id {
      font-size: 14px;
      color: #999;
      margin-bottom: 10px;
    }

    .submission-date {
      font-size: 14px;
      color: #666;
    }

    .section-title {
      font-size: 20px;
      color: #333;
      margin-bottom: 20px;
      margin-top: 30px;
      font-weight: 600;
      padding-bottom: 10px;
      border-bottom: 2px solid #5fa88a;
    }

    .section-title:first-of-type {
      margin-top: 0;
    }

    .field-group {
      margin-bottom: 25px;
    }

    .field-label {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 5px;
      display: block;
    }

    .field-value {
      font-size: 16px;
      color: #333;
    }

    .field-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
    }

    .checkbox-value {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      margin-right: 10px;
      margin-bottom: 5px;
    }

    .checkbox-yes {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .checkbox-no {
      background: #ffebee;
      color: #c62828;
    }

    .file-link {
      color: #5fa88a;
      text-decoration: none;
      font-weight: 500;
    }

    .file-link:hover {
      text-decoration: underline;
    }

    .facilities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #5fa88a;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .field-grid {
        grid-template-columns: 1fr;
      }

      .header-content {
        flex-direction: column;
        gap: 15px;
      }

      .facilities-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>Quote Slip Details</h1>
      <div class="header-nav">
        <a href="/admin/quote-slip" class="btn btn-back">← Back to List</a>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Loading submission...</p>
    </div>

    <div id="submissionContent" style="display: none;">
      <div class="submission-card">
        <div class="submission-header">
          <div class="submission-id">Submission ID: #<span id="submissionId"></span></div>
          <div class="submission-date">Submitted: <span id="submissionDate"></span></div>
        </div>

        <h2 class="section-title">Strata Information</h2>
        <div class="field-grid">
          <div class="field-group">
            <span class="field-label">Strata Management Name</span>
            <div class="field-value" id="strataManagementName"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Contact Person</span>
            <div class="field-value" id="contactPerson"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Strata Plan Number</span>
            <div class="field-value" id="strataPlanNumber"></div>
          </div>
        </div>

        <h2 class="section-title">Address</h2>
        <div class="field-grid">
          <div class="field-group">
            <span class="field-label">Street Address</span>
            <div class="field-value" id="address"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Street Address Line 2</span>
            <div class="field-value" id="streetAddressLine2"></div>
          </div>
          <div class="field-group">
            <span class="field-label">City</span>
            <div class="field-value" id="city"></div>
          </div>
          <div class="field-group">
            <span class="field-label">State</span>
            <div class="field-value" id="state"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Postal Code</span>
            <div class="field-value" id="postal"></div>
          </div>
        </div>

        <h2 class="section-title">Insurance Details</h2>
        <div class="field-grid">
          <div class="field-group">
            <span class="field-label">Renewal Date</span>
            <div class="field-value" id="renewalDate"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Current Insurer</span>
            <div class="field-value" id="currentInsurer"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Current Building Sum Insured</span>
            <div class="field-value" id="currentBuildingSumInsured"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Requested Sum Insured</span>
            <div class="field-value" id="requestedSumInsured"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Current Standard Excess</span>
            <div class="field-value" id="currentStandardExcess"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Current Certificate of Currency</span>
            <div class="field-value" id="currentCocFile"></div>
          </div>
        </div>

        <h2 class="section-title">Building Details</h2>
        <div class="field-grid">
          <div class="field-group">
            <span class="field-label">Roof Type</span>
            <div class="field-value" id="roofType"></div>
          </div>
          <div class="field-group">
            <span class="field-label">External Wall Type</span>
            <div class="field-value" id="externalWallType"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Floor Type</span>
            <div class="field-value" id="floorType"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Building Type</span>
            <div class="field-value" id="buildingType"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Year Built</span>
            <div class="field-value" id="yearBuilt"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Number of Lots</span>
            <div class="field-value" id="numberOfLots"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Number of Floors</span>
            <div class="field-value" id="numberOfFloors"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Number of Lifts</span>
            <div class="field-value" id="numberOfLifts"></div>
          </div>
        </div>

        <h2 class="section-title">Facilities</h2>
        <div class="facilities-grid" id="facilities"></div>

        <h2 class="section-title">Covers</h2>
        <div class="field-grid">
          <div class="field-group">
            <span class="field-label">Flood Cover Required</span>
            <div id="requiredCoverFlood"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Office Bearers</span>
            <div id="coverOfficeBearers"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Office Bearers Value</span>
            <div class="field-value" id="coverOfficeBearersValue"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Machinery Breakdown</span>
            <div id="coverMachineryBreakdown"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Machinery Breakdown Value</span>
            <div class="field-value" id="coverMachineryBreakdownValue"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Catastrophe</span>
            <div id="coverCatastrophe"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Catastrophe Value</span>
            <div class="field-value" id="coverCatastropheValue"></div>
          </div>
        </div>

        <h2 class="section-title">Disclosures</h2>
        <div class="field-group">
          <span class="field-label">Insurance Declined Previously</span>
          <div id="discloseInsuranceDeclined"></div>
        </div>
        <div class="field-group">
          <span class="field-label">Asbestos Present</span>
          <div id="discloseAsbestosPresent"></div>
        </div>
        <div class="field-group">
          <span class="field-label">Heritage Listed</span>
          <div id="discloseHeritageListed"></div>
        </div>
        <div class="field-group">
          <span class="field-label">ACP/EPS Present</span>
          <div class="field-value" id="acpEpsPresent"></div>
        </div>
        <div class="field-group">
          <span class="field-label">ACP/EPS Name</span>
          <div class="field-value" id="acpEpsName"></div>
        </div>
        <div class="field-group">
          <span class="field-label">Defects Affecting Property</span>
          <div class="field-value" id="defectsAffectingProperty"></div>
        </div>
        <div class="field-group">
          <span class="field-label">AFSS Current</span>
          <div class="field-value" id="afssCurrent"></div>
        </div>
        <div class="field-group">
          <span class="field-label">Residential Less Than 20% Commercial</span>
          <div class="field-value" id="residentialLessThan20Commercial"></div>
        </div>
        <div class="field-group">
          <span class="field-label">Major Works Over $500k</span>
          <div class="field-value" id="majorWorksOver500k"></div>
        </div>

        <h2 class="section-title">Uploaded Documents</h2>
        <div class="field-grid" id="documents"></div>

        <h2 class="section-title">Declaration</h2>
        <div class="field-group" id="declarations"></div>
        <div class="field-grid">
          <div class="field-group">
            <span class="field-label">Full Name</span>
            <div class="field-value" id="declarationFullName"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Position</span>
            <div class="field-value" id="declarationPosition"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Confirm Disclosures</span>
            <div class="field-value" id="confirmDisclosures"></div>
          </div>
          <div class="field-group">
            <span class="field-label">Signature</span>
            <div class="field-value" id="signatureFile"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let submissionId = null;

    async function checkAuth() {
      try {
        const response = await fetch('/api/admin/check-session');
        const data = await response.json();

        if (!data.authenticated) {
          window.location.href = '/admin-login.html';
          return false;
        }
        return true;
      } catch (error) {
        console.error('Auth check error:', error);
        window.location.href = '/admin-login.html';
        return false;
      }
    }

    async function loadSubmission() {
      const pathParts = window.location.pathname.split('/');
      submissionId = pathParts[pathParts.length - 1];

      try {
        const response = await fetch(`/api/quote-slip-submissions/${submissionId}`);
        if (!response.ok) {
          throw new Error('Submission not found');
        }

        const submission = await response.json();
        displaySubmission(submission);

        document.getElementById('loading').style.display = 'none';
        document.getElementById('submissionContent').style.display = 'block';
      } catch (error) {
        console.error('Error loading submission:', error);
        alert('Failed to load submission');
        window.location.href = '/admin/quote-slip';
      }
    }

    function displaySubmission(s) {
      document.getElementById('submissionId').textContent = s.id;
      
      const date = new Date(s.submittedAt);
      document.getElementById('submissionDate').textContent = date.toLocaleString();

      document.getElementById('strataManagementName').textContent = s.strataManagementName || 'N/A';
      document.getElementById('contactPerson').textContent = s.contactPerson || 'N/A';
      document.getElementById('strataPlanNumber').textContent = s.strataPlanNumber || 'N/A';
      
      document.getElementById('address').textContent = s.address || 'N/A';
      document.getElementById('streetAddressLine2').textContent = s.streetAddressLine2 || 'N/A';
      document.getElementById('city').textContent = s.city || 'N/A';
      document.getElementById('state').textContent = s.state || 'N/A';
      document.getElementById('postal').textContent = s.postal || 'N/A';

      document.getElementById('renewalDate').textContent = s.renewalDate || 'N/A';
      document.getElementById('currentInsurer').textContent = s.currentInsurer || 'N/A';
      document.getElementById('currentBuildingSumInsured').textContent = formatCurrency(s.currentBuildingSumInsured);
      document.getElementById('requestedSumInsured').textContent = formatCurrency(s.requestedSumInsured);
      document.getElementById('currentStandardExcess').textContent = formatCurrency(s.currentStandardExcess);
      document.getElementById('currentCocFile').innerHTML = getFileHTML(s.currentCocFile);

      document.getElementById('roofType').textContent = s.roofType || 'N/A';
      document.getElementById('externalWallType').textContent = s.externalWallType || 'N/A';
      document.getElementById('floorType').textContent = s.floorType || 'N/A';
      document.getElementById('buildingType').textContent = s.buildingType || 'N/A';
      document.getElementById('yearBuilt').textContent = s.yearBuilt || 'N/A';
      document.getElementById('numberOfLots').textContent = s.numberOfLots || 'N/A';
      document.getElementById('numberOfFloors').textContent = s.numberOfFloors || 'N/A';
      document.getElementById('numberOfLifts').textContent = s.numberOfLifts || 'N/A';

      displayFacilities(s);
      
      document.getElementById('requiredCoverFlood').innerHTML = getCheckboxHTML(s.requiredCoverFlood);
      document.getElementById('coverOfficeBearers').innerHTML = getCheckboxHTML(s.coverOfficeBearers);
      document.getElementById('coverOfficeBearersValue').textContent = formatCurrency(s.coverOfficeBearersValue);
      document.getElementById('coverMachineryBreakdown').innerHTML = getCheckboxHTML(s.coverMachineryBreakdown);
      document.getElementById('coverMachineryBreakdownValue').textContent = formatCurrency(s.coverMachineryBreakdownValue);
      document.getElementById('coverCatastrophe').innerHTML = getCheckboxHTML(s.coverCatastrophe);
      document.getElementById('coverCatastropheValue').textContent = formatCurrency(s.coverCatastropheValue);

      document.getElementById('discloseInsuranceDeclined').innerHTML = getCheckboxHTML(s.discloseInsuranceDeclined);
      document.getElementById('discloseAsbestosPresent').innerHTML = getCheckboxHTML(s.discloseAsbestosPresent);
      document.getElementById('discloseHeritageListed').innerHTML = getCheckboxHTML(s.discloseHeritageListed);
      document.getElementById('acpEpsPresent').textContent = s.acpEpsPresent || 'N/A';
      document.getElementById('acpEpsName').textContent = s.acpEpsName || 'N/A';
      document.getElementById('defectsAffectingProperty').textContent = s.defectsAffectingProperty || 'N/A';
      document.getElementById('afssCurrent').textContent = s.afssCurrent || 'N/A';
      document.getElementById('residentialLessThan20Commercial').textContent = s.residentialLessThan20Commercial || 'N/A';
      document.getElementById('majorWorksOver500k').textContent = s.majorWorksOver500k || 'N/A';

      displayDocuments(s);
      displayDeclarations(s);

      document.getElementById('declarationFullName').textContent = s.declarationFullName || 'N/A';
      document.getElementById('declarationPosition').textContent = s.declarationPosition || 'N/A';
      document.getElementById('confirmDisclosures').textContent = s.confirmDisclosures || 'N/A';
      
      if (s.signatureFile) {
        document.getElementById('signatureFile').innerHTML = `
          <div style="margin-top: 10px;">
            <img src="/uploads/${s.signatureFile}" alt="Signature" style="max-width: 400px; border: 1px solid #ddd; padding: 10px; background: white;">
          </div>
        `;
      } else {
        document.getElementById('signatureFile').innerHTML = '<span style="color: #999;">No signature uploaded</span>';
      }
    }

    function displayFacilities(s) {
      const facilities = [
        { label: 'Pools/Spas', value: s.facilityPoolsSpas },
        { label: 'Jetty', value: s.facilityJetty },
        { label: 'Fire Safety Systems', value: s.facilityFireSafetySystems },
        { label: 'Playground', value: s.facilityPlayground },
        { label: 'Lake', value: s.facilityLake },
        { label: 'Sprinklers', value: s.facilitySprinklers },
        { label: 'Gym', value: s.facilityGym },
        { label: 'Water Feature', value: s.facilityWaterFeature },
        { label: 'EV Chargers', value: s.facilityEvCharges },
        { label: 'Tennis Court', value: s.facilityTennisCourt },
        { label: 'Car Stacker', value: s.facilityCarStacker }
      ];

      const facilitiesDiv = document.getElementById('facilities');
      facilities.forEach(f => {
        const div = document.createElement('div');
        div.innerHTML = `<strong>${f.label}:</strong> ${getCheckboxHTML(f.value)}`;
        facilitiesDiv.appendChild(div);
      });
    }

    function displayDocuments(s) {
      const documents = [
        { label: 'Defects Relevant Docs', file: s.defectsRelevantDocsFile },
        { label: 'WHS', file: s.whsFile },
        { label: 'Claims History', file: s.claimsHistoryFile },
        { label: 'Strata Plans', file: s.strataPlansFile },
        { label: 'Asbestos Report', file: s.asbestosReportFile },
        { label: 'Commercial Tenant List', file: s.commercialTenantListFile },
        { label: 'Most Recent Valuation', file: s.mostRecentValuationFile },
        { label: 'Preventative Maintenance Program', file: s.preventativeMaintenanceProgramFile }
      ];

      const docsDiv = document.getElementById('documents');
      documents.forEach(doc => {
        const div = document.createElement('div');
        div.className = 'field-group';
        div.innerHTML = `
          <span class="field-label">${doc.label}</span>
          <div class="field-value">${getFileHTML(doc.file)}</div>
        `;
        docsDiv.appendChild(div);
      });
    }

    function displayDeclarations(s) {
      const declarations = [
        { label: 'Authorised', value: s.declarationAuthorised },
        { label: 'Appoint Unlockt', value: s.declarationAppointUnlockt },
        { label: 'Accurate Information', value: s.declarationAccurateInfo },
        { label: 'Strata Manager', value: s.declarationStrataManager },
        { label: 'True Answers', value: s.declarationTrueAnswers }
      ];

      const declDiv = document.getElementById('declarations');
      declarations.forEach(d => {
        const div = document.createElement('div');
        div.style.marginBottom = '10px';
        div.innerHTML = `<strong>${d.label}:</strong> ${getCheckboxHTML(d.value)}`;
        declDiv.appendChild(div);
      });
    }

    function formatCurrency(value) {
      if (!value) return 'N/A';
      const num = parseInt(value);
      if (isNaN(num)) return value;
      return '$' + num.toLocaleString();
    }

    function getCheckboxHTML(value) {
      if (value) {
        return '<span class="checkbox-value checkbox-yes">✓ Yes</span>';
      } else {
        return '<span class="checkbox-value checkbox-no">✗ No</span>';
      }
    }

    function getFileHTML(filename) {
      if (!filename) return 'N/A';
      return `<a href="/uploads/${filename}" class="file-link" target="_blank">View File</a>`;
    }

    async function init() {
      const authenticated = await checkAuth();
      if (authenticated) {
        await loadSubmission();
      }
    }

    init();
  </script>
</body>
</html>
